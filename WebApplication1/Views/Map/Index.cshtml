@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<link href="~/Content/ol.css" rel="stylesheet" />
<link href="~/Content/siteMap.css" rel="stylesheet" />

<script src="~/Content/ol.js"></script>

<div id="divMap"></div>

<div id="divOptions" style="background-color: white; font-family: serif; font-weight: bold; color: dodgerblue;">

    <label>Latitude</label>
    <input type="text" id="txtLatitude" readonly="true">
    <br>
    <label>Longitude</label>
    <input type="text" id="txtLongitude" readonly="true">
    <br>
    <br>
    <select id="varKonture">
        <option value="Concave Hull">Concave Hull</option>
        <option value="Convex Hull">Convex Hull</option>
    </select>
    <br>
    <br>
    <label>Attributes:</label>
    <br>
    <input type="radio" id="time" value="time" name="Attributes">
    <label>Time</label>
    <br>
    <input type="radio" id="energy" value="energy" name="Attributes">
    <label>Energy</label>
    <br>
    <br>
    <label>Choose time:</label>
    <br>
    <select id="varTime">
        <option value="1">1 min</option>
        <option value="2">2 min</option>
        <option value="3">3 min</option>
        <option value="4">4 min</option>
        <option value="5">5 min</option>
        <option value="6">6 min</option>
        <option value="7">7 min</option>
        <option value="8">8 min</option>
        <option value="9">9 min</option>
        <option value="10">10 min</option>
        <option value="11">11 min</option>
        <option value="12">12 min</option>
        <option value="13">13 min</option>
        <option value="14">14 min</option>
        <option value="15">15 min</option>
        <option value="16">16 min</option>
        <option value="17">17 min</option>
        <option value="18">18 min</option>
        <option value="19">19 min</option>
        <option value="20">20 min</option>
    </select>
    <br>
    <br>
    <label>Choose Energy:</label>
    <br>
    <input type="text" id="varEnergy" placeholder="Energy in kJ">
    <br>
    <br>
    <button class="btn btn-primary" type="button" style="width: 45%; margin: 2px; padding: 3px" + onclick="computeConture()">
        Start
    </button>

</div>

@*Glavni dio javascript koda*@
<script type="text/javascript">
    var longitude = 0
    var latitude =0
    var plotedObjects = [];
    var plotedVectorSources = [];

    var map = new ol.Map({
        interactions: ol.interaction.defaults({ doubleClickZoom: false }),
        target: 'divMap',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([15.981179, 45.805281]),
            zoom: 12
        })
    });

    var vectorSource = new ol.source.Vector({});

    map.on('dblclick', function (event) {
        var koordinate = ol.proj.toLonLat(event.coordinate);

        longitude = koordinate[0];
        latitude = koordinate[1];

        document.getElementById('txtLatitude').value = latitude;
        document.getElementById('txtLongitude').value = longitude;



    });

    //Varijable



    //varijabla za Odabir vremena
    var dropdown = document.getElementById('varTime');
    var selectedVarTime = '';

    selectedVarTime = dropdown.options[0].value;
    dropdown.addEventListener("change", function () {
        selectedVarTime = dropdown.options[dropdown.selectedIndex].value
    });


    var dropdown2 = document.getElementById('varKonture');
    var selectedVarKonture = '';

    selectedVarKonture = dropdown2.options[0].value;
    dropdown2.addEventListener("change", function () {
        selectedVarKonture = dropdown2.options[dropdown.selectedIndex].value
    });



    function computeConture() {
        //varijabla za radio gumb
        var selectedType = document.querySelector('input[name="Attributes"]:checked').value;

        //varijabla za Odabir energije
        var selectedVarEnergy = document.getElementById("varEnergy").value;

        $.ajax({
             type: "POST",
            url: "@Url.Action("ComputeConture")",
            data: { longitude: longitude, latitude: latitude, selectedType: selectedType, selectedVarTime: selectedVarTime, selectedVarEnergy: selectedVarEnergy, selectedVarKonture: selectedVarKonture, strVrijemePocetka: 0 },
            success: succesfullCall,//Funkcija koja se poziva ako je poziv bio uspješan
            failure: function (response) {
            //Ispiši grešku u malom prozorčiću
            alert(response.error);
            }
        });

    }

    function succesfullCall(response) {
        console.log(response);

        var wkt = response;

        // Parse the WKT to create a geometry
        var polygonGeometry = new ol.format.WKT().readGeometry(wkt, {
            dataProjection: 'EPSG:4326', // WGS84
            featureProjection: 'EPSG:3857' // Spherical Mercator
        });

        console.log(polygonGeometry);

        // Create a feature using the polygon geometry
        var polygonFeature = new ol.Feature(polygonGeometry);

        // Create a vector source and add the feature to it
        var vectorSource = new ol.source.Vector({
            features: [polygonFeature]
        });

        color = random_rgba();
        console.log(color);
        // Define the style for the vector layer
        var vectorStyle = new ol.style.Style({
            fill: new ol.style.Fill({
                color: color// Red color with 50% transparency
            }),
            stroke: new ol.style.Stroke({
                color: color,
                width: 2
            })
        });

        // Create a vector layer with the vector source and the defined style
        var vectorLayer = new ol.layer.Vector({
            source: vectorSource,
            style: vectorStyle
        });


        // Add the vector layer to the map
        map.addLayer(vectorLayer);
    }

    // Funkcija za stvaranje slučajne boje
    function random_rgba() {
        var o = Math.round, r = Math.random, s = 255;
        return 'rgba(' + o(r() * s) + ',' + o(r() * s) + ',' + o(r() * s) + ',0.5)';
    }


</script>